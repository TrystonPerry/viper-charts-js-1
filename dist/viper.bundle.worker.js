(()=>{"use strict";function e(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}}(e,r)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const r=function(){return Math.random().toString(36).substr(2,13)},n=function(e,t,r){var n=((t+=r-t%r)-(e-=e%r))/r;return n%1!=0||0===n?[]:new Array(n).fill().map((function(t,n){return e+r*n}))},o=function(e,t,r,n){var o=(n-e)/(t-e);return-Math.floor(o*r-r)},a=function(e,t){return+parseFloat(e).toFixed(t)},i=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(isNaN(t))return 0;var n=t.toString();if(n.indexOf("e-")>-1){var o=n.split("e-"),a=e(o,2),i=(a[0],a[1]);return Math.min(parseInt(i,10),r)}return Math.floor(t)!==t?Math.min(t.toString().split(".")[1].length||0,r):0},l=function(e){var t,r,n;return e.match(/^rgb/)?(t=(e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],r=e[2],n=e[3]):(t=(e=+("0x"+e.slice(1).replace(e.length<5&&/./g,"$&$&")))>>16,r=e>>8&255,n=255&e),Math.sqrt(t*t*.299+r*r*.587+n*n*.114)>127.5},s={"price-line":{id:"price-line",name:"Price Line",draw:function(e){var t=e.close;(0,e.plot)({value:t,title:"Price line",color:this.color,linewidth:2,ylabel:!0})}},candlestick:{id:"candlestick",name:"Candlestick",draw:function(e){var t=e.open,r=e.high,n=e.low,o=e.close,a=o>=t?"#C4FF49":"#FE3A64";(0,e.plotCandle)({open:t,high:r,low:n,close:o,title:"Candlestick",color:a,wickcolor:a,ylabel:!0})}},sma:{id:"sma",name:"SMA",draw:function(e){(0,e.plot)({value:(0,e.sma)({source:"close",length:20}),title:"MA20",color:this.color,linewidth:2})}},"ma-slope":{id:"ma-slope",name:"MA Slope",draw:function(e){var t=e.plot,r=e.sma,n=e.setVar,o=e.getVar,a=r({source:"close",length:20});n({name:"ma20",value:a}),t({value:a-o({name:"ma20",lookback:1}),title:"MA20 Slope",color:this.color,linewidth:2,ylabel:!0})}},"volume-bar":{id:"volume-bar",name:"Volume",draw:function(e){var t=e.open,r=e.close,n=e.volume;(0,e.plotVolume)({volume:n,color:r>=t?this.upColor:this.downColor})}}};function c(e){if(null==e)throw new TypeError("Cannot destructure undefined")}const u={plot:function(e,t){var r=e.addSetItem,n=e.time,o=t.value,a=t.title,i=t.color,l=void 0===i?"#FFF":i,s=t.linewidth,c=t.ylabel;r(n,"line",{series:[o],title:a,colors:{color:l},linewidth:s,ylabel:void 0!==c&&c})},plotBox:function(e,t){var r=e.addSetItem,n=e.time,o=t.top,a=t.bottom,i=t.width,l=t.title,s=t.color;r(n,"box",{series:[o,a,i],title:l,colors:{color:void 0===s?"#FFF":s},ylabel})},plotVolume:function(e,t){var r=e.addSetItem,n=e.time,o=t.volume,a=t.title,i=t.color;r(n,"volume",{series:[o],title:a,colors:{color:void 0===i?"#FFF":i}})},plotCandle:function(e,t){var r=e.addSetItem,n=e.time,o=t.open,a=t.high,i=t.low,l=t.close,s=t.title,c=t.color,u=void 0===c?"#FFF":c,f=t.wickcolor,h=void 0===f?"#FFF":f,d=t.ylabel;r(n,"candle",{series:[o,a,i,l],title:s,colors:{color:u,wickcolor:h},ylabel:void 0!==d&&d})},plotText:function(){},getData:function(e,t){var r=e.set,n=e.timeframe,o=e.data,a=e.time,i=t.lookback,l=t.source;r.addLookback(i);var s=o[a-i*n];if(s)return s[l]},setVar:function(e,t){var r=e.time,n=e.computedState,o=t.name,a=t.value;n[r]||(n[r]={}),n[r][o]=a},getVar:function(e,t){var r=e.set,n=e.time,o=e.timeframe,a=e.computedState,i=t.name,l=t.lookback;r.addLookback(l);var s=a[n-l*o];if(s)return s[i]},sma:function(e,t){c(e);for(var r=t.source,n=t.length,o=0,a=0,i=0;i<n;i++){var l=this.getData(arguments[0],{lookback:i,source:r});isNaN(l)||"number"!=typeof l||(a++,o+=l)}return o/a},declareGlobal:function(e,t){var r=e.globals,n=t.name,o=t.value;return r[n]||(r[n]=o),r[n]},setGlobal:function(e,t){var r=e.globals,n=t.name,o=t.value;return r[n]=o,o}},f={main:{background:{},grid:{},layers:{0:{}},plots:{}},yScale:{background:{},scales:[],plots:{},crosshair:{}},xScale:{background:{},scales:[],crosshair:{}}};function h(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=d(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function d(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const v={getMinAndMax:function(e,t){var r,n,o=[],a=h(t);try{for(a.s();!(r=a.n()).done;){var i=r.value,l=e.data[i];if(l){var s,c=h(l);try{for(c.s();!(s=c.n()).done;){var u=s.value;o.push.apply(o,function(e){if(Array.isArray(e))return y(e)}(n=u.values.series)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||d(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}catch(e){c.e(e)}finally{c.f()}}}}catch(e){a.e(e)}finally{a.f()}return[Math.min.apply(Math,o),Math.max.apply(Math,o)]},getFirstValue:function(e,t){var r,n=h(t);try{for(n.s();!(r=n.n()).done;){var o=r.value,a=e.data[o];if(a&&a.length)return a[0].values.series[0]}}catch(e){n.e(e)}finally{n.f()}},getVisibleRange:function(e,t,r,n){if(t.lockedYScale){var o=.05*(n-r);e.min=r-o,e.max=n+o}return e},calculatePixelsPerElement:function(e,t,r,n){return n/((t-e)/r)}};var p=1e3,m=6e4,b=36e5,x=24*b,g=7*x,w=4*g,S=365*x;const M={MILLISECOND:1,MILLISECOND100:100,SECOND:p,MINUTE:m,MINUTE5:3e5,MINUTE15:9e5,HOUR:b,HOUR4:144e5,HOUR12:432e5,DAY:x,WEEK:g,MONTH:w,YEAR:S,TIMESCALES:[10*S,5*S,3*S,2*S,S,6*w,4*w,3*w,2*w,w,15*x,10*x,7*x,5*x,3*x,2*x,x,12*b,6*b,4*b,2*b,b,18e5,9e5,6e5,3e5,12e4,m,3e4,15e3,1e4,5e3,2e3,p,500,250,100,50,1],TIMEFRAMES:{ms:1,s:p,m,h:b,d:x,w:g,mo:w,y:S}};function I(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const A={main:{layers:{default:function(e,t,r,n,a,i){for(var l={},s=o(a.min,a.max,i.main.height,e.visibleMin),c=o(a.min,a.max,i.main.height,e.visibleMax)-s,u=e.visibleMax-e.visibleMin,f=e.data,h=function(t){return Math.floor((t-e.visibleMin)/u*c+s)},d=0;d<t.length;d++){var y=t[d],v=r[d],p=f[y];if(p){l[y]=[];var m,b=I(p);try{for(b.s();!(m=b.n()).done;){var x=m.value,g=x.type,w=x.values,S=w.series;if("line"===g)l[y].push({type:"line",x:v,y:h(S[0]),color:w.colors.color,linewidth:w.linewidth});else if("box"===g){var M=h(S[0]),k=h(S[1]),A=n*S[3];l[y].push({type:"box",x:v-A/2,y:M,w:A,h:k-M,color:w.colors.color})}else if("candle"===g){var O=h(S[0]),E=h(S[1]),P=h(S[2]),j=h(S[3]),F=.9*n;l[y].push({type:"box",x:v-F/2,y:O,w:F,h:j-O,color:w.colors.color}),l[y].push({type:"single-line",x:v,y:E,x2:v,y2:P,color:w.colors.wickcolor})}}}catch(e){b.e(e)}finally{b.f()}}}return l},percent:function(e,t,r,n,a,i){for(var l={},s=o(a.min,a.max,i.main.height,e.visibleScaleMin),c=o(a.min,a.max,i.main.height,e.visibleScaleMax)-s,u=e.visibleMax-e.visibleMin,f=e.data,h=function(t){return Math.floor((t-e.visibleMin)/u*c+s)},d=0;d<t.length;d++){var y=t[d],v=r[d],p=f[y];if(p){l[y]=[];var m,b=I(p);try{for(b.s();!(m=b.n()).done;){var x=m.value,g=x.type,w=x.values,S=w.series;if("line"===g)l[y].push({type:"line",x:v,y:h(S[0]),color:w.colors.color,linewidth:w.linewidth});else if("box"===g){var M=h(S[0]),k=h(S[1]),A=n*S[3];l[y].push({type:"box",x:v-A/2,y:M,w:A,h:k-M,color:w.colors.color})}else if("candle"===g){var O=h(S[0]),E=h(S[1]),P=h(S[2]),j=h(S[3]),F=.9*n;l[y].push({type:"box",x:v-F/2,y:O,w:F,h:j-O,color:w.colors.color}),l[y].push({type:"single-line",x:v,y:E,x2:v,y2:P,color:w.colors.wickcolor})}}}catch(e){b.e(e)}finally{b.f()}}}return l},normalized:function(e,t,r,n,a,i){for(var l={},s=o(a.min,a.max,i.main.height,e.visibleScaleMin),c=o(a.min,a.max,i.main.height,e.visibleScaleMax)-s,u=e.visibleMax-e.visibleMin,f=e.data,h=function(t){return Math.floor((t-e.visibleMin)/u*c+s)},d=0;d<t.length;d++){var y=t[d],v=r[d],p=f[y];if(p){l[y]=[];var m,b=I(p);try{for(b.s();!(m=b.n()).done;){var x=m.value,g=x.type,w=x.values,S=w.series;if("line"===g)l[y].push({type:"line",x:v,y:h(S[0]),color:w.colors.color,linewidth:w.linewidth});else if("box"===g){var M=h(S[0]),k=h(S[1]),A=n*S[3];l[y].push({type:"box",x:v-A/2,y:M,w:A,h:k-M,color:w.colors.color})}else if("candle"===g){var O=h(S[0]),E=h(S[1]),P=h(S[2]),j=h(S[3]),F=.9*n;l[y].push({type:"box",x:v-F/2,y:O,w:F,h:j-O,color:w.colors.color}),l[y].push({type:"single-line",x:v,y:E,x2:v,y2:P,color:w.colors.wickcolor})}}}catch(e){b.e(e)}finally{b.f()}}}return l}}},yScale:{plots:{default:function(e,t,r,n,a){for(var i=[],s=[],c=t.length-1;c>=0;c--){var u=t[c],f=e.data[u];if(f){var h,d=I(f);try{for(d.s();!(h=d.n()).done;){var y=h.value,v=y.type,p=y.values;if(p.ylabel){var m=p.series[{line:0,candle:3}[v]],b=o(a.min,a.max,n.yScale.height,m),x=l(p.colors.color)?"#000":"#FFF";i.push({type:"box",x:0,y:b-13,w:n.yScale.width,h:20,color:p.colors.color}),i.push({type:"text",x:n.yScale.width/2,y:b,color:x,text:"".concat(m),font:"bold 10px Arial"});var g="".concat(r.datasetId),w=7*g.length;s.push({type:"box",x:n.main.width-w,y:b-13,w,h:20,color:p.colors.color}),s.push({type:"text",x:n.main.width-w/2,y:b,color:x,text:g,font:"bold 10px Arial"})}}}catch(e){d.e(e)}finally{d.f()}break}}return[i,s]},percent:function(e,t,r,n,i){for(var s=[],c=[],u=t.length-1;u>=0;u--){var f=t[u],h=e.data[f];if(h){var d,y=I(h);try{for(y.s();!(d=y.n()).done;){var p=d.value,m=p.type,b=p.values;if(b.ylabel){var x=v.getFirstValue(e,t),g=b.series[{line:0,candle:3}[m]];g=(g-x)/x*100;var w=o(i.min,i.max,n.yScale.height,g),S=l(b.colors.color)?"#000":"#FFF",M=g>=0?"+":"";s.push({type:"box",x:0,y:w-13,w:n.yScale.width,h:20,color:b.colors.color}),s.push({type:"text",x:n.yScale.width/2,y:w,color:S,text:"".concat(M).concat(a(g,2),"%"),font:"bold 10px Arial"});var k="".concat(r.datasetId),A=7*k.length;c.push({type:"box",x:n.main.width-A,y:w-13,w:A,h:20,color:b.colors.color}),c.push({type:"text",x:n.main.width-A/2,y:w,color:S,text:k,font:"bold 10px Arial"})}}}catch(e){y.e(e)}finally{y.f()}break}}return[s,c]},normalized:function(e,t,r,n,i){for(var s=[],c=[],u=t.length-1;u>=0;u--){var f=t[u],h=e.data[f];if(h){var d,y=I(h);try{for(y.s();!(d=y.n()).done;){var v=d.value,p=v.type,m=v.values;if(m.ylabel){var b=m.series[{line:0,candle:3}[p]];b=a((b-e.visibleMin)/(e.visibleMax-e.visibleMin)*100,2);var x=o(i.min,i.max,n.yScale.height,b),g=l(m.colors.color)?"#000":"#FFF";s.push({type:"box",x:0,y:x-13,w:n.yScale.width,h:20,color:m.colors.color}),s.push({type:"text",x:n.yScale.width/2,y:x,color:g,text:"".concat(b),font:"bold 10px Arial"});var w="".concat(r.datasetId),S=7*w.length;c.push({type:"box",x:n.main.width-S,y:x-13,w:S,h:20,color:m.colors.color}),c.push({type:"text",x:n.main.width-S/2,y:x,color:g,text:w,font:"bold 10px Arial"})}}}catch(e){y.e(e)}finally{y.f()}break}}return[s,c]}},scales:function(){return[]}},xScale:{scales:function(e,t,r){for(var n=[],o=0,a=M.TIMESCALES.indexOf(t);a>=0;a--)if(e*(M.TIMESCALES[a]/t)>=100){o=M.TIMESCALES[a];break}for(var i=r.start-r.start%o;i<r.end;i+=o)n.push(i);return n}}};function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var E=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._events={}}var t,n;return t=e,n=[{key:"addEventListener",value:function(e,t){var n=r();return void 0!==this._events[e]?this._events[e].push(t):this._events[e]=[t],n}},{key:"removeEventListener",value:function(e,t){var r=this._events[e];if(r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},{key:"fireEvent",value:function(e){var t=Object.values(this._events[e]||{});if(t&&t.length){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var a=0,i=t;a<i.length;a++){var l=i[a];l.apply(void 0,n)}}}}],n&&O(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}}(e,t)||L(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=L(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function T(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){if(e){if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function D(e,t){return D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},D(e,t)}function q(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){V(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function V(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Q(e,t,r){return t&&U(e.prototype,t),r&&U(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var H=function(){function e(t){var r=t.$state,n=t.timeframe,o=t.data,a=void 0===o?{}:o;$(this,e),this.$state=r,this.data=a,this.timeframe=n,this.min=1/0,this.max=-1/0,this.visibleMin=1/0,this.visibleMax=-1/0,this.visibleScaleMin=1/0,this.visibleScaleMax=-1/0,this.decimalPlaces=0,this.maxLookback=0,this.maxLookforward=0}return Q(e,[{key:"setDecimalPlaces",value:function(e){this.decimalPlaces=e,this.$state.calculateMaxDecimalPlaces()}},{key:"addLookback",value:function(e){0!==e&&(e>0&&e>this.maxLookback&&(this.maxLookback=e),e<0&&e<-this.maxLookforward&&(this.maxLookforward=-e))}}]),e}(),Y=function(){function e(t){var r=t.chartId;$(this,e),this.chartId=r,this.state={maxDecimalPlaces:0}}return Q(e,[{key:"setState",value:function(e){this.state=_(_({},this.state),e),self.postMessage({type:"setState",chartId,state:this.state})}},{key:"updateInstructions",value:function(e){self.postMessage({type:"updateInstructions",data:{chartId:this.chartId,instructions:e}})}}]),e}(),z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D(e,t)}(l,e);var t,o,a=(t=l,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=R(t);if(o){var n=R(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return q(this,e)});function l(e){var t,r=e.chartId;return $(this,l),(t=a.call(this)).chartId=r,t.mainThread=new Y({chartId:r}),t.queue=new Map,t.sets={},t.computedState={},t.max=-1/0,t.min=1/0,t.maxDecimalPlaces=0,t.offsetX=0,t.offsetY=0,t}return Q(l,[{key:"calculateOneSet",value:function(e){var t=this,r=e.renderingQueueId,o=e.timestamps,a=e.dataset,l=a.timeframe,c=this.queue.get(r);if(c.draw=s[c.id].draw,c.visible){this.sets[r]||(this.sets[r]=new H({$state:this,timeframe:l}));var f=this.sets[r];if(f.maxLookback){var h=+o[o.length-1],d=h+l,y=h+l*f.maxLookback;o=[].concat(T(o),T(n(d,y,l)))}if(f.maxLookforward){var v=+o[0],p=v-l*f.maxLookforward;o=[].concat(T(n(p,v-l,l)),T(o))}var m=0,b={},x=function(e,n,o){if(!o.series.filter((function(e){return isNaN(e)||"number"!=typeof e})).length){f.data[e]=[],f.data[e].push({type:n,values:o});var a,l=F(o.series);try{for(l.s();!(a=l.n()).done;){var s=a.value;if(f.decimalPlaces<8){var c=i(s,8);c>f.decimalPlaces&&f.setDecimalPlaces(c)}}}catch(e){l.e(e)}finally{l.f()}t.sets[r]=f}}.bind(this);this.computedState[r]||(this.computedState[r]={});var g={},w=function(e){g[e]=function(){return u[e].apply(u,[{set:f,addSetItem:x,time:m,timeframe:l,data:a.data,globals:b,computedState:this.computedState[r]}].concat(Array.prototype.slice.call(arguments)))}.bind(t)};for(var S in u)w(S);var M,I=F(o);try{for(I.s();!(M=I.n()).done;){var k=M.value;m=k,delete f.data[m];var A=a.data[m];null!=A&&c.draw(_(_({},A),g))}}catch(e){I.e(e)}finally{I.f()}}}},{key:"addToQueue",value:function(e){var t=e.indicator,n=r();do{n=r()}while(this.queue.has(n));return this.queue.set(n,t),{renderingQueueId:n}}},{key:"setVisibility",value:function(e){var t=e.renderingQueueId,r=e.visible;if(this.queue.has(t)){var n=this.queue.get(t);n.visible=r,this.queue.set(t,n),this.calculateMaxDecimalPlaces(),n.visible||(delete this.instructions.main.layers[0][t],delete this.instructions.main.plots[t],delete this.instructions.yScale.plots[t],this.mainThread.updateInstructions(this.instructions))}else console.error("".concat(t," was not found in rendering queue"))}},{key:"emptySet",value:function(e){var t=e.renderingQueueId;delete this.sets[t],delete this.computedState[t],this.calculateMaxDecimalPlaces(),delete this.instructions.main.layers[0][t],delete this.instructions.main.plots[t],delete this.instructions.yScale.plots[t],this.mainThread.updateInstructions(this.instructions)}},{key:"emptyAllSets",value:function(){for(var e in this.sets)this.emptySet({renderingQueueId:e})}},{key:"removeFromQueue",value:function(e){var t=e.renderingQueueId;if(!this.queue.has(t))return console.error("".concat(t," was not found in rendering queue")),!1;this.queue.delete(t),this.emptySet({renderingQueueId:t}),delete this.instructions.main.layers[0][t],delete this.instructions.yScale.plots[t]}},{key:"generateAllInstructions",value:function(e){var t=e.scaleType,r=e.requestedRange,o=e.timeframe,a=e.chartDimensions,i=e.pixelsPerElement,l=e.settings,s=n(r.start,r.end,o),c=1/0,u=-1/0;for(var h in this.sets)if(this.queue.get(h).visible){var d=j(v.getMinAndMax(this.sets[h],s),2),y=d[0],p=d[1],m=y,b=p;if(this.sets[h].visibleMin=y,this.sets[h].visibleMax=p,"percent"===l.scaleType){var x=v.getFirstValue(this.sets[h],s);m=(y-x)/x*100,b=(p-x)/x*100}"normalized"===l.scaleType&&(m=0,b=100),this.sets[h].visibleScaleMin=m,this.sets[h].visibleScaleMax=b,m<c&&(c=m),b>u&&(u=b)}this.min=c,this.max=u;var g=v.getVisibleRange.bind(this)(r,l,c,u);i=v.calculatePixelsPerElement(g.start,g.end,o,a.main.width);var w=f,S=s.map((function(e){return t=g.start,r=g.end,n=a.main.width,o=(e-t)/(r-t),Math.floor(o*n);var t,r,n,o}));for(var M in this.sets){var I=this.sets[M],k=this.queue.get(M);if(k.visible){var O=A.main.layers[t];w.main.layers[0][M]=O(I,s,S,i,g,a);var E=j((0,A.yScale.plots[t])(I,s,k,a,g),2),P=E[0],F=E[1];w.yScale.plots[M]=P,w.main.plots[M]=F}}w.yScale.scales=A.yScale.scales(),w.xScale.scales=A.xScale.scales(i,o,g),this.instructions=w;var T=this.maxDecimalPlaces;return"default"!==l.scaleType&&(T=2),{instructions:w,visibleRange:g,pixelsPerElement:i,maxDecimalPlaces:T}}},{key:"calculateMaxDecimalPlaces",value:function(){var e=0;for(var t in this.sets)if(this.queue.get(t).visible){var r=this.sets[t].decimalPlaces;r>e&&(e=r)}this.maxDecimalPlaces=e}}]),l}(E),B={};self.addEventListener("message",(function(e){var t=e.data,r=t.type,n=t.data;switch(r){case"id":break;case"addComputedState":B[n.chartId]=new z({chartId:n.chartId});break;case"runComputedStateMethod":var o=B[n.chartId][n.method](n.params);n.resolveId&&postMessage({type:"resolve",chartId:n.chartId,resolveId:n.resolveId,res:o});break;case"deleteComputedState":delete B[n.chartId];break;default:console.error("No implementation for type: ".concat(r))}}))})();