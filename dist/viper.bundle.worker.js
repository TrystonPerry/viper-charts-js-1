(()=>{"use strict";function e(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}}(e,r)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const r=function(){return Math.random().toString(36).substr(2,13)},n=function(e,t,r){var n=((t+=r-t%r)-(e-=e%r))/r;return n%1!=0||0===n?[]:new Array(n).fill().map((function(t,n){return e+r*n}))},o=function(e,t,r,n){var o=(n-e)/(t-e);return-Math.floor(o*r-r)},a=function(e,t){return+parseFloat(e).toFixed(t)},i=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(isNaN(t))return 0;var n=t.toString();if(n.indexOf("e-")>-1){var o=n.split("e-"),a=e(o,2),i=(a[0],a[1]);return Math.min(parseInt(i,10),r)}return Math.floor(t)!==t?Math.min(t.toString().split(".")[1].length||0,r):0},l=function(e){var t,r,n;return e.match(/^rgb/)?(t=(e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/))[1],r=e[2],n=e[3]):(t=(e=+("0x"+e.slice(1).replace(e.length<5&&/./g,"$&$&")))>>16,r=e>>8&255,n=255&e),Math.sqrt(t*t*.299+r*r*.587+n*n*.114)>127.5};function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f={"volume-bar":{version:"1.0.0",name:"Volume",dependencies:["ohlc","volume"],draw:function(e){var t=e.open,r=e.close,n=e.plotVolume,o=r>=t?this.upColor:this.downColor;n({volume:f,color:o})}}},d={bases:{line:{version:"1.0.0",name:"Line",dependencies:["value"],draw:function(e){var t=e.value;(0,e.plot)({value:t,title:"Line",color:this.color,linewidth:2,ylabel:!0})}},candlestick:{version:"1.0.0",name:"Candlestick",dependencies:["ohlc"],draw:function(e){var t=e.open,r=e.high,n=e.low,o=e.close,a=o>=t?"#C4FF49":"#FE3A64";(0,e.plotCandle)({open:t,high:r,low:n,close:o,title:"Candlestick",color:a,wickcolor:a,ylabel:!0})}},footprint:{version:"1.0.0",name:"Footprint",dependencies:["footprint"],draw:function(e){var t=e.spread,r=e.prices,n=e.plotBox;for(var o in e.times,r){var a=r[o=+o],i=a.buy,l=a.sell;i&&n({top:o+t,bottom:o,width:i/t/3,color:"#C4FF49"}),l&&n({top:o+t,bottom:o,width:-l/t/3,color:"#FE3A64"})}}}},volume:f,indicators:{sma:{version:"1.0.0",name:"SMA",dependencies:["value"],draw:function(e){(0,e.plot)({value:(0,e.sma)({source:"value",length:20}),title:"MA20",color:this.color,linewidth:2})}},"ma-slope":{version:"1.0.0",name:"MA Slope",dependencies:["value"],draw:function(e){var t=e.plot,r=e.sma,n=e.setVar,o=e.getVar,a=r({source:"value",length:20});n({name:"ma20",value:a}),t({value:a-o({name:"value",lookback:1}),title:"MA20 Slope",color:this.color,linewidth:2,ylabel:!0})}},deltafootprint:{version:"1.0.0",name:"Delta Footprint",dependencies:["footprint"],draw:function(e){var t=e.spread,r=e.prices,n=e.plotBox;for(var o in r){var a=r[o=+o],i=a.buy-a.sell;n({top:o+t,bottom:o,width:Math.abs(i),color:i>=0?"#C4FF49":"#FE3A64"})}}},volumePerTick:{version:"1.0.0",name:"Volume Per Tick",dependencies:["footprint"],draw:function(e){var t=e.spread,r=e.prices,n=e.plotBox,o=Object.keys(r),a=Math.max(Math.abs(o[0]-o[o.length-1])/t,t),i=0,l=0;for(var c in r)i+=r[c].buy,l+=r[c].sell;var s=i+l,u=i/a*s,f=l/a*s,d=u-f;n({top:Math.floor(u),bottom:0,width:1,center:!0,color:"#C4FF4966"}),n({top:0,bottom:-Math.ceil(f),width:1,center:!0,color:"#FE3A6466"}),n({top:d>0?Math.floor(d):0,bottom:d>0?0:Math.floor(d),width:1,center:!0,color:d>0?"#C4FF49":"#FE3A64"})}},volumeProfileSession:{version:"1.0.0",name:"Volume Profile Session",dependencies:["footprint"],draw:function(e){var t=e.spread,r=e.prices,n=e.plotBox,o=0,a={};for(var i in r){var l=r[i],c=l.buy,s=l.sell,u=c+s,f=c-s;a[i]={total:u,delta:f},u>o&&(o=u)}for(var d in a){var h=a[d=+d],v=h.total,y=h.delta;n({top:d+t,bottom:d,width:v/o*.9,color:y>=0?"#C4FF49AA":"#FE3A64AA"}),n({top:d+t,bottom:d,width:Math.abs(y)/o*.9,color:y>=0?"#C4FF49":"#FE3A64"})}}}}};for(var h in d)for(var v in d[h]){var y=d[h][v];y.id=v,y.type=h}const p=s(s({},d),{},{getIndicatorById:function(e){for(var t in d)for(var r in d[t])if(r===e)return d[t][r]}});function m(e){if(null==e)throw new TypeError("Cannot destructure undefined")}const b={plot:function(e,t){var r=e.addSetItem,n=e.time,o=t.value,a=t.title,i=t.color,l=void 0===i?"#FFF":i,c=t.linewidth,s=t.ylabel;r(n,"line",{series:[o],title:a,colors:{color:l},linewidth:c,ylabel:void 0!==s&&s})},plotBox:function(e,t){var r=e.addSetItem,n=e.time,o=t.top,a=t.bottom,i=t.width,l=t.center,c=void 0!==l&&l,s=t.title,u=t.color,f=void 0===u?"#FFF":u,d=t.ylabel;r(n,"box",{series:[o,a],width:i,title:s,center:c,colors:{color:f},ylabel:void 0!==d&&d})},plotVolume:function(e,t){var r=e.addSetItem,n=e.time,o=t.volume,a=t.title,i=t.color;r(n,"volume",{series:[o],title:a,colors:{color:void 0===i?"#FFF":i}})},plotCandle:function(e,t){var r=e.addSetItem,n=e.time,o=t.open,a=t.high,i=t.low,l=t.close,c=t.title,s=t.color,u=void 0===s?"#FFF":s,f=t.wickcolor,d=void 0===f?"#FFF":f,h=t.ylabel;r(n,"candle",{series:[o,a,i,l],title:c,colors:{color:u,wickcolor:d},ylabel:void 0!==h&&h})},plotText:function(){},getData:function(e,t){var r=e.set,n=e.timeframe,o=e.data,a=e.time,i=t.lookback,l=t.source;r.addLookback(i);var c=o[a-i*n];if(c)return c[l]},setVar:function(e,t){var r=e.time,n=e.computedState,o=t.name,a=t.value;n[r]||(n[r]={}),n[r][o]=a},getVar:function(e,t){var r=e.set,n=e.time,o=e.timeframe,a=e.computedState,i=t.name,l=t.lookback;r.addLookback(l);var c=a[n-l*o];if(c)return c[i]},sma:function(e,t){m(e);for(var r=t.source,n=t.length,o=0,a=0,i=0;i<n;i++){var l=this.getData(arguments[0],{lookback:i,source:r});isNaN(l)||"number"!=typeof l||(a++,o+=l)}return o/a},declareGlobal:function(e,t){var r=e.globals,n=t.name,o=t.value;return r[n]||(r[n]=o),r[n]},setGlobal:function(e,t){var r=e.globals,n=t.name,o=t.value;return r[n]=o,o}},w={main:{background:{},grid:{},layers:{0:{}},plots:{}},yScale:{background:{},scales:[],plots:{},crosshair:{}},xScale:{background:{},scales:[],crosshair:{}}};function g(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=x(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function x(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const M={getMinAndMax:function(e,t){var r,n,o=[],a=g(t);try{for(a.s();!(r=a.n()).done;){var i=r.value,l=e.data[i];if(l){var c,s=g(l);try{for(s.s();!(c=s.n()).done;){var u=c.value;o.push.apply(o,function(e){if(Array.isArray(e))return S(e)}(n=u.values.series)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||x(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){a.e(e)}finally{a.f()}return function(e){for(var t=e.length,r=-1/0,n=1/0;t--;)r=e[t]>r?e[t]:r,n=e[t]<n?e[t]:n;return[n,r]}(o)},getFirstValue:function(e,t){var r,n=g(t);try{for(n.s();!(r=n.n()).done;){var o=r.value,a=e.data[o];if(a&&a.length)return a[0].values.series[0]}}catch(e){n.e(e)}finally{n.f()}},getVisibleRange:function(e,t,r,n){if(t.lockedYScale){var o=.05*(n-r);e.min=r-o,e.max=n+o}return e},calculatePixelsPerElement:function(e,t,r,n){return n/((t-e)/r)}};var I=1e3,k=6e4,O=36e5,A=24*O,F=7*A,P=4*F,j=365*A;const E={MILLISECOND:1,MILLISECOND100:100,SECOND:I,MINUTE:k,MINUTE5:3e5,MINUTE15:9e5,HOUR:O,HOUR4:144e5,HOUR12:432e5,DAY:A,WEEK:F,MONTH:P,YEAR:j,TIMESCALES:[10*j,5*j,3*j,2*j,j,6*P,4*P,3*P,2*P,P,15*A,10*A,7*A,5*A,3*A,2*A,A,12*O,6*O,4*O,2*O,O,18e5,9e5,6e5,3e5,12e4,k,3e4,15e3,1e4,5e3,2e3,I,500,250,100,50,1],TIMEFRAMES:{ms:1,s:I,m:k,h:O,d:A,w:F,mo:P,y:j}};function T(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const D={main:{layers:{default:function(e,t,r,n,a,i){for(var l={},c=o(a.min,a.max,i.main.height,e.visibleMin),s=o(a.min,a.max,i.main.height,e.visibleMax)-c,u=e.visibleMax-e.visibleMin,f=e.data,d=function(t){return Math.floor((t-e.visibleMin)/u*s+c)},h=0;h<t.length;h++){var v=t[h],y=r[h],p=f[v];if(p){l[v]=[];var m,b=T(p);try{for(b.s();!(m=b.n()).done;){var w=m.value,g=w.type,x=w.values,S=x.series;if("line"===g)l[v].push({type:"line",x:y,y:d(S[0]),color:x.colors.color,linewidth:x.linewidth});else if("box"===g){var M=x.center?n/2:0,I=d(S[0]),k=d(S[1]),O=n*x.width;l[v].push({type:"box",x:y-M,y:I,w:O,h:k-I,color:x.colors.color})}else if("candle"===g){var A=d(S[0]),F=d(S[1]),P=d(S[2]),j=d(S[3]),E=.9*n;l[v].push({type:"box",x:y-E/2,y:A,w:E,h:j-A,color:x.colors.color}),l[v].push({type:"single-line",x:y,y:F,x2:y,y2:P,color:x.colors.wickcolor})}}}catch(e){b.e(e)}finally{b.f()}}}return l},percent:function(e,t,r,n,a,i){for(var l={},c=o(a.min,a.max,i.main.height,e.visibleScaleMin),s=o(a.min,a.max,i.main.height,e.visibleScaleMax)-c,u=e.visibleMax-e.visibleMin,f=e.data,d=function(t){return Math.floor((t-e.visibleMin)/u*s+c)},h=0;h<t.length;h++){var v=t[h],y=r[h],p=f[v];if(p){l[v]=[];var m,b=T(p);try{for(b.s();!(m=b.n()).done;){var w=m.value,g=w.type,x=w.values,S=x.series;if("line"===g)l[v].push({type:"line",x:y,y:d(S[0]),color:x.colors.color,linewidth:x.linewidth});else if("box"===g){var M=d(S[0]),I=d(S[1]),k=n*S[3];l[v].push({type:"box",x:y-k/2,y:M,w:k,h:I-M,color:x.colors.color})}else if("candle"===g){var O=d(S[0]),A=d(S[1]),F=d(S[2]),P=d(S[3]),j=.9*n;l[v].push({type:"box",x:y-j/2,y:O,w:j,h:P-O,color:x.colors.color}),l[v].push({type:"single-line",x:y,y:A,x2:y,y2:F,color:x.colors.wickcolor})}}}catch(e){b.e(e)}finally{b.f()}}}return l},normalized:function(e,t,r,n,a,i){for(var l={},c=o(a.min,a.max,i.main.height,e.visibleScaleMin),s=o(a.min,a.max,i.main.height,e.visibleScaleMax)-c,u=e.visibleMax-e.visibleMin,f=e.data,d=function(t){return Math.floor((t-e.visibleMin)/u*s+c)},h=0;h<t.length;h++){var v=t[h],y=r[h],p=f[v];if(p){l[v]=[];var m,b=T(p);try{for(b.s();!(m=b.n()).done;){var w=m.value,g=w.type,x=w.values,S=x.series;if("line"===g)l[v].push({type:"line",x:y,y:d(S[0]),color:x.colors.color,linewidth:x.linewidth});else if("box"===g){var M=d(S[0]),I=d(S[1]),k=n*S[3];l[v].push({type:"box",x:y-k/2,y:M,w:k,h:I-M,color:x.colors.color})}else if("candle"===g){var O=d(S[0]),A=d(S[1]),F=d(S[2]),P=d(S[3]),j=.9*n;l[v].push({type:"box",x:y-j/2,y:O,w:j,h:P-O,color:x.colors.color}),l[v].push({type:"single-line",x:y,y:A,x2:y,y2:F,color:x.colors.wickcolor})}}}catch(e){b.e(e)}finally{b.f()}}}return l}}},yScale:{plots:{default:function(e,t,r,n,a){for(var i=[],c=[],s=t.length-1;s>=0;s--){var u=t[s],f=e.data[u];if(f){var d,h=T(f);try{for(h.s();!(d=h.n()).done;){var v=d.value,y=v.type,p=v.values;if(p.ylabel){var m=p.series[{line:0,candle:3}[y]],b=o(a.min,a.max,n.yScale.height,m),w=l(p.colors.color)?"#000":"#FFF";i.push({type:"box",x:0,y:b-13,w:n.yScale.width,h:20,color:p.colors.color}),i.push({type:"text",x:n.yScale.width/2,y:b,color:w,text:"".concat(m),font:"bold 10px Arial"});var g="".concat(r.datasetId),x=7*g.length;c.push({type:"box",x:n.main.width-x,y:b-13,w:x,h:20,color:p.colors.color}),c.push({type:"text",x:n.main.width-x/2,y:b,color:w,text:g,font:"bold 10px Arial"})}}}catch(e){h.e(e)}finally{h.f()}break}}return[i,c]},percent:function(e,t,r,n,i){for(var c=[],s=[],u=t.length-1;u>=0;u--){var f=t[u],d=e.data[f];if(d){var h,v=T(d);try{for(v.s();!(h=v.n()).done;){var y=h.value,p=y.type,m=y.values;if(m.ylabel){var b=M.getFirstValue(e,t),w=m.series[{line:0,candle:3}[p]];w=(w-b)/b*100;var g=o(i.min,i.max,n.yScale.height,w),x=l(m.colors.color)?"#000":"#FFF",S=w>=0?"+":"";c.push({type:"box",x:0,y:g-13,w:n.yScale.width,h:20,color:m.colors.color}),c.push({type:"text",x:n.yScale.width/2,y:g,color:x,text:"".concat(S).concat(a(w,2),"%"),font:"bold 10px Arial"});var I="".concat(r.datasetId),k=7*I.length;s.push({type:"box",x:n.main.width-k,y:g-13,w:k,h:20,color:m.colors.color}),s.push({type:"text",x:n.main.width-k/2,y:g,color:x,text:I,font:"bold 10px Arial"})}}}catch(e){v.e(e)}finally{v.f()}break}}return[c,s]},normalized:function(e,t,r,n,i){for(var c=[],s=[],u=t.length-1;u>=0;u--){var f=t[u],d=e.data[f];if(d){var h,v=T(d);try{for(v.s();!(h=v.n()).done;){var y=h.value,p=y.type,m=y.values;if(m.ylabel){var b=m.series[{line:0,candle:3}[p]];b=a((b-e.visibleMin)/(e.visibleMax-e.visibleMin)*100,2);var w=o(i.min,i.max,n.yScale.height,b),g=l(m.colors.color)?"#000":"#FFF";c.push({type:"box",x:0,y:w-13,w:n.yScale.width,h:20,color:m.colors.color}),c.push({type:"text",x:n.yScale.width/2,y:w,color:g,text:"".concat(b),font:"bold 10px Arial"});var x="".concat(r.datasetId),S=7*x.length;s.push({type:"box",x:n.main.width-S,y:w-13,w:S,h:20,color:m.colors.color}),s.push({type:"text",x:n.main.width-S/2,y:w,color:g,text:x,font:"bold 10px Arial"})}}}catch(e){v.e(e)}finally{v.f()}break}}return[c,s]}},scales:function(){return[]}},xScale:{scales:function(e,t,r){for(var n=[],o=0,a=E.TIMESCALES.indexOf(t);a>=0;a--)if(e*(E.TIMESCALES[a]/t)>=100){o=E.TIMESCALES[a];break}for(var i=r.start-r.start%o;i<r.end;i+=o)n.push(i);return n}}};function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var q=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._events={}}var t,n;return t=e,n=[{key:"addEventListener",value:function(e,t){var n=r();return void 0!==this._events[e]?this._events[e].push(t):this._events[e]=[t],n}},{key:"removeEventListener",value:function(e,t){var r=this._events[e];if(r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},{key:"fireEvent",value:function(e){var t=Object.values(this._events[e]||{});if(t&&t.length){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];for(var a=0,i=t;a<i.length;a++){var l=i[a];l.apply(void 0,n)}}}}],n&&L(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}}(e,t)||$(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function _(e){return function(e){if(Array.isArray(e))return U(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,t){if(e){if("string"==typeof e)return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?U(e,t):void 0}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function Q(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){G(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function K(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(e,t,r){return t&&W(e.prototype,t),r&&W(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}var J=function(){function e(t){var r=t.$state,n=t.timeframe,o=t.data,a=void 0===o?{}:o;K(this,e),this.$state=r,this.data=a,this.timeframe=n,this.min=1/0,this.max=-1/0,this.visibleMin=1/0,this.visibleMax=-1/0,this.visibleScaleMin=1/0,this.visibleScaleMax=-1/0,this.decimalPlaces=0,this.maxLookback=0,this.maxLookforward=0}return X(e,[{key:"setDecimalPlaces",value:function(e){this.decimalPlaces=e,this.$state.calculateMaxDecimalPlaces()}},{key:"addLookback",value:function(e){0!==e&&(e>0&&e>this.maxLookback&&(this.maxLookback=e),e<0&&e<-this.maxLookforward&&(this.maxLookforward=-e))}}]),e}(),Z=function(){function e(t){var r=t.chartId;K(this,e),this.chartId=r,this.state={maxDecimalPlaces:0}}return X(e,[{key:"setState",value:function(e){this.state=z(z({},this.state),e),self.postMessage({type:"setState",chartId,state:this.state})}},{key:"updateInstructions",value:function(e){self.postMessage({type:"updateInstructions",data:{chartId:this.chartId,instructions:e}})}}]),e}(),ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(l,e);var t,o,a=(t=l,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=H(t);if(o){var n=H(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return Q(this,e)});function l(e){var t,r=e.chartId;return K(this,l),(t=a.call(this)).chartId=r,t.mainThread=new Z({chartId:r}),t.queue=new Map,t.sets={},t.computedState={},t.max=-1/0,t.min=1/0,t.maxDecimalPlaces=0,t.offsetX=0,t.offsetY=0,t}return X(l,[{key:"calculateOneSet",value:function(e){var t=this,r=e.renderingQueueId,o=e.timestamps,a=e.dataset,l=a.timeframe,c=this.queue.get(r);if(c.draw=p.getIndicatorById(c.id).draw,c.visible){this.sets[r]||(this.sets[r]=new J({$state:this,timeframe:l}));var s=this.sets[r];if(s.maxLookback){var u=+o[o.length-1],f=u+l,d=u+l*s.maxLookback;o=[].concat(_(o),_(n(f,d,l)))}if(s.maxLookforward){var h=+o[0],v=h-l*s.maxLookforward;o=[].concat(_(n(v,h-l,l)),_(o))}var y=0,m={},w=function(e,n,o){if(!o.series.filter((function(e){return isNaN(e)||"number"!=typeof e})).length){s.data[e]||(s.data[e]=[]),s.data[e].push({type:n,values:o});var a,l=N(o.series);try{for(l.s();!(a=l.n()).done;){var c=a.value;if(s.decimalPlaces<8){var u=i(c,8);u>s.decimalPlaces&&s.setDecimalPlaces(u)}}}catch(e){l.e(e)}finally{l.f()}t.sets[r]=s}}.bind(this);this.computedState[r]||(this.computedState[r]={});var g={},x=function(e){g[e]=function(){return b[e].apply(b,[{set:s,addSetItem:w,time:y,timeframe:l,data:a.data,globals:m,computedState:this.computedState[r]}].concat(Array.prototype.slice.call(arguments)))}.bind(t)};for(var S in b)x(S);var M,I=N(o);try{for(I.s();!(M=I.n()).done;){var k=M.value;y=k,delete s.data[y];var O=a.data[y];if(null!=O){var A=O[c.model.id];if("value"===c.dependencies[0]&&"ohlc"===c.model.model){if(void 0===O[c.model.id])continue;A={value:O[c.model.id].close}}c.draw(z(z(z({},A),g),{},{times:{iteratedTime:y,timeframe:l}}))}}}catch(e){I.e(e)}finally{I.f()}}}},{key:"addToQueue",value:function(e){var t=e.indicator,n=r();do{n=r()}while(this.queue.has(n));return this.queue.set(n,t),{renderingQueueId:n}}},{key:"setVisibility",value:function(e){var t=e.renderingQueueId,r=e.visible;if(this.queue.has(t)){var n=this.queue.get(t);n.visible=r,this.queue.set(t,n),this.calculateMaxDecimalPlaces(),n.visible||(delete this.instructions.main.layers[0][t],delete this.instructions.main.plots[t],delete this.instructions.yScale.plots[t],this.mainThread.updateInstructions(this.instructions))}else console.error("".concat(t," was not found in rendering queue"))}},{key:"emptySet",value:function(e){var t=e.renderingQueueId;delete this.sets[t],delete this.computedState[t],this.calculateMaxDecimalPlaces(),delete this.instructions.main.layers[0][t],delete this.instructions.main.plots[t],delete this.instructions.yScale.plots[t],this.mainThread.updateInstructions(this.instructions)}},{key:"emptyAllSets",value:function(){for(var e in this.sets)this.emptySet({renderingQueueId:e})}},{key:"removeFromQueue",value:function(e){var t=e.renderingQueueId;if(!this.queue.has(t))return console.error("".concat(t," was not found in rendering queue")),!1;this.queue.delete(t),this.emptySet({renderingQueueId:t}),delete this.instructions.main.layers[0][t],delete this.instructions.yScale.plots[t]}},{key:"generateAllInstructions",value:function(e){var t=e.scaleType,r=e.requestedRange,o=e.timeframe,a=e.chartDimensions,i=e.pixelsPerElement,l=e.settings,c=n(r.start,r.end,o),s=1/0,u=-1/0;for(var f in this.sets)if(this.queue.get(f).visible){var d=V(M.getMinAndMax(this.sets[f],c),2),h=d[0],v=d[1],y=h,p=v;if(this.sets[f].visibleMin=h,this.sets[f].visibleMax=v,"percent"===l.scaleType){var m=M.getFirstValue(this.sets[f],c);y=(h-m)/m*100,p=(v-m)/m*100}"normalized"===l.scaleType&&(y=0,p=100),this.sets[f].visibleScaleMin=y,this.sets[f].visibleScaleMax=p,y<s&&(s=y),p>u&&(u=p)}this.min=s,this.max=u;var b=M.getVisibleRange.bind(this)(r,l,s,u);i=M.calculatePixelsPerElement(b.start,b.end,o,a.main.width);var g=w,x=c.map((function(e){return t=b.start,r=b.end,n=a.main.width,o=(e-t)/(r-t),Math.floor(o*n);var t,r,n,o}));for(var S in this.sets){var I=this.sets[S],k=this.queue.get(S);if(k.visible){var O=D.main.layers[t];g.main.layers[0][S]=O(I,c,x,i,b,a);var A=V((0,D.yScale.plots[t])(I,c,k,a,b),2),F=A[0],P=A[1];g.yScale.plots[S]=F,g.main.plots[S]=P}}g.yScale.scales=D.yScale.scales(),g.xScale.scales=D.xScale.scales(i,o,b),this.instructions=g;var j=this.maxDecimalPlaces;return"default"!==l.scaleType&&(j=2),{instructions:g,visibleRange:b,pixelsPerElement:i,maxDecimalPlaces:j}}},{key:"calculateMaxDecimalPlaces",value:function(){var e=0;for(var t in this.sets)if(this.queue.get(t).visible){var r=this.sets[t].decimalPlaces;r>e&&(e=r)}this.maxDecimalPlaces=e}}]),l}(q),te={};self.addEventListener("message",(function(e){var t=e.data,r=t.type,n=t.data;switch(r){case"id":break;case"addComputedState":te[n.chartId]=new ee({chartId:n.chartId});break;case"runComputedStateMethod":var o=te[n.chartId][n.method](n.params);n.resolveId&&postMessage({type:"resolve",chartId:n.chartId,resolveId:n.resolveId,res:o});break;case"deleteComputedState":delete te[n.chartId];break;default:console.error("No implementation for type: ".concat(r))}}))})();